var define,requireModule,require,requirejs;!function(){var t={},e={};define=function(e,r,i){t[e]={deps:r,callback:i}},requirejs=require=requireModule=function(r){function i(t){if("."!==t.charAt(0))return t;for(var e=t.split("/"),i=r.split("/").slice(0,-1),n=0,s=e.length;s>n;n++){var o=e[n];if(".."===o)i.pop();else{if("."===o)continue;i.push(o)}}return i.join("/")}if(requirejs._eak_seen=t,e.hasOwnProperty(r))return e[r];if(e[r]={},!t[r])throw new Error("Could not find module "+r);for(var n,s=t[r],o=s.deps,a=s.callback,h=[],u=0,c=o.length;c>u;u++)h.push("exports"===o[u]?n={}:requireModule(i(o[u])));var p=a.apply(this,h);return e[r]=n||p}}(),define("canvas-image",["funderscore","drawing","exports"],function(t,e,r){"use strict";var i,n=(t["default"],e["default"]),s={}.hasOwnProperty,o=function(t,e){function r(){this.constructor=t}for(var i in e)s.call(e,i)&&(t[i]=e[i]);return r.prototype=e.prototype,t.prototype=new r,t.__super__=e.prototype,t};i=function(t){function e(t){e.__super__.constructor.call(this,t),this.source=t.source,this.naturalWidth=t.naturalWidth,this.naturalHeight=t.naturalHeight,this.originalNaturalBounds=this.naturalBounds(),this.brightness=0,this.contrast=0,this.cropped=!1,this.history=[],this.loaded=!1,this.cropX=0,this.cropY=0,this.cropWidth=this.naturalWidth,this.cropHeight=this.naturalHeight,this.updateBrightnessAndContrastTable(),this.loadImage()}return o(e,t),e.prototype.clearImage=function(){return this.loaded=!1,this.cropped=!1,this.brightness=0,this.contrast=0,this.w=null,this.h=null,this.naturalWidth=null,this.naturalHeight=null,this.history=[],this.originalNaturalBounds=this.naturalBounds(),this.updateBrightnessAndContrastTable(),this.markDirty()},e.prototype.getSource=function(){return this.source},e.prototype.setSource=function(t){return this.clearImage(),this.source=t,this.loadImage()},e.prototype.naturalBounds=function(){return{x:0,y:0,w:this.naturalWidth,h:this.naturalHeight}},e.prototype.cropFrame=function(){return{x:this.cropX,y:this.cropY,w:this.cropWidth,h:this.cropHeight}},e.prototype.adjustBrightness=function(t){var e;return e=this.brightness,this.brightness=t,this.updateBrightnessAndContrastTable(),this.history.push({action:"adjustBrightness",fromBrightness:e,toBrightness:t}),this.trigger("adjustBrightness",this,e,this.brightness),this.markDirty()},e.prototype.adjustContrast=function(t){var e;return e=this.contrast,this.contrast=t,this.updateBrightnessAndContrastTable(),this.history.push({action:"adjustContrast",fromContrast:e,toContrast:t}),this.trigger("adjustContrast",this,e,this.contrast),this.markDirty()},e.prototype.crop=function(t){var e;return this.cropped||(this.cropped=!0,this.cropX=this.cropY=0),e=this.cropFrame(),this.cropX=t.x+this.cropX,this.cropY=t.y+this.cropY,this.cropWidth=t.width,this.cropHeight=t.height,this.naturalWidth=this.cropWidth,this.naturalHeight=this.cropHeight,this.resizeToParent(),this.centerOnParent(),this.history.push({action:"crop",fromCropFrame:e,toCropFrame:this.cropFrame()}),this.trigger("crop",this,e,this.cropFrame()),this.markDirty()},e.prototype.isChanged=function(){return this.history.length>0},e.prototype.undo=function(){var t,e;if(this.history.length>0){switch(t=this.history.pop(),t.action){case"crop":e=t.fromCropFrame,this.cropX=e.x,this.cropY=e.y,this.cropWidth=e.w,this.cropHeight=e.h,this.naturalWidth=e.w,this.naturalHeight=e.h,this.resizeToParent(),this.centerOnParent(),0===this.cropX&&0===this.cropY&&this.cropWidth===this.naturalWidth&&this.cropHeight===this.naturalHeight&&(this.cropped=!1),this.trigger("crop",this,t.toCropFrame,this.cropFrame());break;case"adjustBrightness":this.brightness=t.fromBrightness,this.updateBrightnessAndContrastTable(),this.trigger("adjustBrightness",this,t.toBrightness,this.brightness);break;case"adjustContrast":this.contrast=t.fromContrast,this.updateBrightnessAndContrastTable(),this.trigger("adjustContrast",this,t.toContrast,this.contrast)}return this.markDirty()}},e.prototype.revertImage=function(){var t,e,r;return this.cropped=!1,this.history.length>0?(r=this.cropFrame(),t=this.brightness,e=this.contrast,this.brightness=0,this.contrast=0,this.cropX=0,this.cropY=0,this.cropWidth=this.originalNaturalBounds.w,this.cropHeight=this.originalNaturalBounds.h,this.naturalWidth=this.originalNaturalBounds.w,this.naturalHeight=this.originalNaturalBounds.h,this.resizeToParent(),this.centerOnParent(),this.updateBrightnessAndContrastTable(),(r.x!==this.cropFrame().x||r.y!==this.cropFrame().y||r.w!==this.cropFrame().w||r.h!==this.cropFrame().h)&&this.trigger("crop",this,r,this.cropFrame()),this.brightness!==t&&this.trigger("adjustBrightness",this,t,this.brightness),this.contrast!==e&&this.trigger("adjustContrast",this,e,this.contrast),this.history=[],this.markDirty()):void 0},e.prototype.commitChanges=function(){return this.history=[]},e.prototype.resizeToParent=function(){var t,e,r,i;return e=this.parent.frame().w,t=this.parent.frame().h,r=1,i=1,this.naturalWidth>e&&(r=e/this.naturalWidth),this.naturalHeight>t&&(i=t/this.naturalHeight),this.scale=Math.min(r,i),this.w=this.naturalWidth*this.scale|0,this.h=this.naturalHeight*this.scale|0,this.trigger("resize",this.frame())},e.prototype.centerOnParent=function(){return this.x=this.parent.frame().w/2-this.w/2|0,this.y=this.parent.frame().h/2-this.h/2|0,this.trigger("reposition",this.frame())},e.prototype.toDataURL=function(t){var e,r,i,n,s,o,a,h;for(null==t&&(t="image/png"),e=document.createElement("canvas"),e.width=this.cropWidth,e.height=this.cropHeight,r=e.getContext("2d"),this.cropped?r.drawImage(this.img,this.cropX,this.cropY,this.cropWidth,this.cropHeight,0,0,this.cropWidth,this.cropHeight):r.drawImage(this.img,0,0,this.cropWidth,this.cropHeight),n=r.getImageData(0,0,this.cropWidth,this.cropHeight),s=n.data,h=this.filters(),o=0,a=h.length;a>o;o++)i=h[o],i.call(this,s);return r.putImageData(n,0,0),e.toDataURL(t)},e.prototype.draw=function(t){return this.loaded?this.positionContext(t,function(t){var e,r,i,n,s,o,a;for(this.cropped?t.drawImage(this.img,this.cropX,this.cropY,this.cropWidth,this.cropHeight,0,0,this.w,this.h):t.drawImage(this.img,0,0,this.w,this.h),e=this.convertToCanvas({x:0,y:0}),i=t.getImageData(e.x,e.y,this.w,this.h),n=i.data,a=this.filters(),s=0,o=a.length;o>s;s++)r=a[s],r.call(this,n);return t.putImageData(i,e.x,e.y)}):void 0},e.prototype.filters=function(){return[this.filterBrightness]},e.prototype.filterBrightness=function(t){var e,r,i;for(e=0,r=t.length,i=[];r>e;)t[e+0]=this.brightnessAndContrastTable[t[e+0]],t[e+1]=this.brightnessAndContrastTable[t[e+1]],t[e+2]=this.brightnessAndContrastTable[t[e+2]],i.push(e+=4);return i},e.prototype.updateBrightnessAndContrastTable=function(){var t,e,r,i,n,s,o,a,h;for(this.brightnessAndContrastTable=[],s=!1,s?r=Math.min(150,Math.max(-150,this.brightness)):e=1+Math.min(150,Math.max(-150,this.brightness))/150,i=Math.max(0,this.contrast+1),1!==i?s?(o=i,t=(r-128)*i+128):(o=e*i,t=128*-i+128):s?(o=1,t=r):(o=e,t=0),n=0,h=[];256>n;)a=n*o+t,this.brightnessAndContrastTable[n]=a>255?255:0>a?0:a,h.push(n++);return h},e.prototype.loadImage=function(){return this.img=document.createElement("img"),this.img.onload=function(t){return function(){return t.loaded=!0,t.naturalWidth=t.img.naturalWidth,t.naturalHeight=t.img.naturalHeight,t.cropped=!1,t.history=[],t.cropX=0,t.cropY=0,t.cropWidth=t.img.naturalWidth,t.cropHeight=t.img.naturalHeight,t.originalNaturalBounds=t.naturalBounds(),t.markDirty(),t.trigger("load",t)}}(this),this.img.src=this.source},e}(n.Drawable),r["default"]=i}),define("funderscore",["exports"],function(t){"use strict";var e,r,i,n,s,o;for(r={},r.clone=function(t){return r.extend({},t)},r.extend=function(t,e){var r;if(e)for(r in e)t[r]=e[r];return t},o=["Arguments","Function","String","Number","Date","RegExp","Boolean"],i=function(t){return r["is"+t]=function(e){return Object.prototype.toString.call(e)==="[object "+t+"]"}},n=0,s=o.length;s>n;n++)e=o[n],i(e);r.now=Date.now||function(){return(new Date).getTime()},r.debounce=function(t,e,i){var n,s,o,a,h,u;return n=null,s=null,u=null,h=null,a=null,o=function(){var c;return c=r.now()-u,e>c&&c>0?h=setTimeout(o,e-c):(h=null,i||(a=t.apply(s,n),h)?void 0:s=n=null)},function(){var c;return s=this,n=arguments,u=r.now(),c=i&&!h,h||(h=setTimeout(o,e)),c&&(a=t.apply(s,n),s=n=null),a}},t["default"]=r}),define("drawing",["funderscore","events","exports"],function(t,e,r){"use strict";var i,n,s,o,a=t["default"],h=e["default"],u={}.hasOwnProperty,c=function(t,e){function r(){this.constructor=t}for(var i in e)u.call(e,i)&&(t[i]=e[i]);return r.prototype=e.prototype,t.prototype=new r,t.__super__=e.prototype,t},p=[].slice;o={},i=function(t){function e(t){this.options=t,this.x=t.x,this.y=t.y,this.w=t.w,this.h=t.h,this.dirty=!0,this.scale=t.scale,this.parent=t.parent,this.canvas=t.canvas,this.children=t.children||[],this.dragable=t.dragable||!1,this.enabled=void 0!==t.enabled?!!t.enabled:!0}return c(e,t),e.prototype.set=function(t){var e,r,i;i=[];for(e in t)u.call(t,e)&&(r=t[e],i.push(this[e]=r));return i},e.prototype.enable=function(t){var e;return e=this.enabled,this.enabled=!!t,this.markDirty(),e!==this.enabled?this.enabled?this.trigger("enabled",this):this.trigger("disabled",this):void 0},e.prototype.markDirty=function(){return this.dirty=!0,this.parent?this.parent.markDirty():void 0},e.prototype.bubble=function(){var t,e,r,i,n;for(r=arguments[0],e=arguments[1],t=3<=arguments.length?p.call(arguments,2):[],e.currentTarget=this,this.trigger.apply(this,arguments),i=this.parent,n=[];i;)e=a.clone(e),e.currentTarget=i,i.trigger.apply(i,[r,e].concat(t)),n.push(i=i.parent);return n},e.prototype.findChildAtPoint=function(t){var e,r,i;for(i=this.children.length-1;i>=0;){if(e=this.children[i],r=e.findChildAtPoint(t))return r;if(e.containsCanvasPoint(t))return e;i--}},e.prototype.bounds=function(){return{x:0,y:0,w:this.w,h:this.h}},e.prototype.frame=function(){return{x:this.x,y:this.y,w:this.w,h:this.h}},e.prototype.convertToParent=function(t){var e;return e=this.frame(),{x:t.x+e.x,y:t.y+e.y}},e.prototype.convertFromParent=function(t){var e;return e=this.frame(),{x:t.x-e.x,y:t.y-e.y}},e.prototype.convertToCanvas=function(t){var e,r,i;for(e=this,r=t.x,i=t.y;e;)r+=e.frame().x,i+=e.frame().y,e=e.parent;return{x:r,y:i}},e.prototype.convertFromCanvas=function(t){var e,r,i;for(e=this,r=t.x,i=t.y;e;)r-=e.frame().x,i-=e.frame().y,e=e.parent;return{x:r,y:i}},e.prototype.positionContext=function(t,e){var r;return t.save(),this.parent&&(r=this.convertToCanvas(this.parent.bounds()),t.translate(r.x,r.y)),e.call(this,t),t.restore()},e.prototype.containsCanvasPoint=function(t){var e;return e=this.convertFromCanvas(t),this.containsPoint(e)},e.prototype.containsPoint=function(t){var e,r,i;return e=this.frame(),0<=(r=t.x)&&r<=e.w&&0<=(i=t.y)&&i<=e.h},e.prototype.addChild=function(t){return t.parent=this,this.children.push(t),this.markDirty()},e.prototype.removeChild=function(t){var e;return e=this.children.indexOf(t),e>=0?(t.parent=null,this.children.splice(e,1),this.markDirty()):void 0},e.prototype.renderChildren=function(t){var e,r,i,n,s;for(n=this.children,s=[],r=0,i=n.length;i>r;r++)e=n[r],s.push(e.enabled?e.render(t):void 0);return s},e.prototype.clear=function(t){var e;return e=this.frame(),this.parent?positionContext(t,function(){return function(t){return t.clearRect(e.x,e.y,e.w,e.h)}}(this)):t.clearRect(e.x,e.y,e.w,e.h)},e.prototype.render=function(t){return this.enabled?(t.save(),this.draw(t),t.restore(),this.renderChildren(t),this.dirty=!1):void 0},e.prototype.draw=function(){},e}(h),o.Drawable=i,n=function(t){function e(t){null==t&&(t={}),e.__super__.constructor.call(this,t),this.padding=t.padding||10,this.fillParent=a.isBoolean(t.fillParent)?t.fillParent:!0}return c(e,t),e.prototype.frame=function(){var t;return this.fillParent?(t=this.parent.frame(),{x:this.padding,y:this.padding,w:t.w-2*this.padding,h:t.h-2*this.padding}):{x:this.x+this.padding,y:this.y+this.padding,w:this.w-2*this.padding,h:this.h-2*this.padding}},e.prototype.outerFrame=function(){var t;return this.fillParent?(t=this.parent.frame(),{x:this.padding,y:this.padding,w:t.w,h:t.h}):{x:this.x,y:this.y,w:this.w,h:this.h}},e.prototype.bounds=function(){var t;return this.fillParent?(t=this.parent.frame(),{x:0,y:0,w:t.w-2*this.padding,h:t.h-2*this.padding}):{x:0,y:0,w:this.w-2*this.padding,h:this.h-2*this.padding}},e.prototype.setFrame=function(t){return t.w&&(this.w=t.w+2*this.padding),t.h&&(this.h=t.h+2*this.padding),t.x&&(this.x=t.x-this.padding),t.y?this.y=t.y-this.padding:void 0},e}(i),o.PaddedContainer=n,s=function(t){function e(t){e.__super__.constructor.call(this,t),this.fillStyle=t.fillStyle||"rgba(0, 0, 0, 0)",this.strokeStyle=t.strokeStyle,this.lineWidth=t.lineWidth}return c(e,t),e.prototype.draw=function(t){return this.positionContext(t,function(t){return function(e){return t.fillStyle&&(e.fillStyle=t.fillStyle),t.strokeStyle&&(e.strokeStyle=t.strokeStyle),t.lineWidth&&(e.lineWidth=t.lineWidth),e.beginPath(),e.rect(0,0,t.w,t.h),e.closePath(),t.fillStyle&&e.fill(),t.lineWidth&&t.strokeStyle?e.stroke():void 0}}(this))},e}(i),o.Rectangle=s,r["default"]=o}),define("events",["funderscore","exports"],function(t,e){"use strict";var r,i,n=t["default"];i=function(){function t(){}return t.prototype.on=function(t,e,r){var i;return this.events||(this.events={}),(i=this.events)[t]||(i[t]=[]),n.isFunction(e)?this.events[t].push([e,r]):void 0},t.prototype.trigger=function(t){var e,r,i,n,s,o,a,h;for(s=Array.prototype.slice.call(arguments,1),i=this.events&&this.events[t]?this.events[t]:[],h=[],o=0,a=i.length;a>o;o++)r=i[o],e=r[0],n=r[1]||this,h.push(e.apply(n,s));return h},t}(),r=function(){function t(t){var e,r;for(e in t)r=t[e],this[e]=r}return t}(),e["default"]=i,e.Event=r}),define("crop-box",["funderscore","drawing","exports"],function(t,e,r){"use strict";var i,n=t["default"],s=e["default"],o={}.hasOwnProperty,a=function(t,e){function r(){this.constructor=t}for(var i in e)o.call(e,i)&&(t[i]=e[i]);return r.prototype=e.prototype,t.prototype=new r,t.__super__=e.prototype,t};i=function(t){function e(t){e.__super__.constructor.call(this,n.extend({dragable:!0},t)),this.image=t.image,this.handleSize=t.handleSize||10,this.screenStyle=t.screenStyle||"rgba(0, 0, 0, .75)",this.topScreen=new s.Rectangle({fillStyle:this.screenStyle}),this.leftScreen=new s.Rectangle({fillStyle:this.screenStyle}),this.rightScreen=new s.Rectangle({fillStyle:this.screenStyle}),this.bottomScreen=new s.Rectangle({fillStyle:this.screenStyle}),this.cropX=t.cropX||0,this.cropY=t.cropY||0,this.cropWidth=t.cropWidth,this.cropHeight=t.cropHeight,this.marchingAnts=t.marchingAnts||!0,this.dashOffset=0,this.dragging=null,this.mouseDown=!1,this.handles={},this.image.on("load",function(t){return function(){return t.setCropFrameAndUpdateFrame(t.cropFrame())}}(this)),this.image.on("crop",function(t){return function(e,r,i){return t.cropX=r.w>=i.w?0:r.x-i.x,t.cropY=r.h>=i.h?0:r.y-i.y,t.cropWidth=r.w>=i.w?i.w:r.w,t.cropHeight=r.h>=i.h?i.h:r.h,t.setCropFrameAndUpdateFrame(t.cropFrame())}}(this)),this.on("mouseout",this.onMouseOut),this.on("mousemove",this.onMouseMove),this.on("mousedown",this.onMouseDown),this.on("mouseup",this.onMouseUp),this.on("dragstart",this.onDragStart),this.on("dragend",this.onDragEnd),this.on("dragmove",this.onDragMove),this.setLooseTheAnts()}return a(e,t),e.prototype.frame=function(){return{x:this.w<0?this.x+this.w:this.x,y:this.h<0?this.y+this.h:this.y,w:Math.abs(this.w),h:Math.abs(this.h)}},e.prototype.cropFrame=function(){return{x:this.cropX,y:this.cropY,width:this.cropWidth,height:this.cropHeight}},e.prototype.updateCropFrameFromFrame=function(){var t,e,r;return t=this.frame(),r=this.image.naturalBounds(),e=this.image.bounds(),this.image.loaded&&(this.cropX=r.w*(t.x/e.w),this.cropY=r.h*(t.y/e.h),this.cropWidth=r.w*(t.w/e.w),this.cropHeight=r.h*(t.h/e.h)),this.trigger("change:cropFrame",this.cropFrame())},e.prototype.setFrameAndUpdateCropArea=function(t){return this.x=t.x,this.y=t.y,this.w=t.w,this.h=t.h,this.updateCropFrameFromFrame(),this.markDirty()},e.prototype.updateFrameFromCropFrame=function(){var t,e;return this.image.loaded?(e=this.image.naturalBounds(),t=this.image.bounds(),this.x=t.w*(this.cropX/e.w),this.y=t.h*(this.cropY/e.h),this.w=t.w*(this.cropWidth/e.w),this.h=t.h*(this.cropHeight/e.h),this.markDirty()):void 0},e.prototype.setCropFrameAndUpdateFrame=function(t){var e,r,i,n,s;return this.image.loaded?(e=this.image.naturalBounds(),n=(null!=t?t.x:void 0)||.125*e.w,s=(null!=t?t.y:void 0)||.125*e.h,i=(null!=t?t.width:void 0)||.75*e.w,r=(null!=t?t.height:void 0)||.75*e.h,this.cropX=Math.min(Math.max(n,0),e.w),this.cropY=Math.min(Math.max(s,0),e.h),this.cropWidth=Math.min(Math.max(i,0),e.w-this.cropX),this.cropHeight=Math.min(Math.max(r,0),e.h-this.cropY),this.updateFrameFromCropFrame()):(this.cropX=null!=t?t.x:void 0,this.cropY=null!=t?t.y:void 0,this.cropWidth=null!=t?t.width:void 0,this.cropHeight=null!=t?t.height:void 0)},e.prototype.bounds=function(){return{x:0,y:0,w:Math.abs(this.w),h:Math.abs(this.h)}},e.prototype.containsCanvasPoint=function(t){var e,r,i,n,s;if(n=this.convertFromCanvas(t),e=this.containsPoint(n))return e;s=this.handles;for(r in s)if(i=s[r],i.containsCanvasPoint(t))return!0;return!1},e.prototype.onMouseOut=function(){return this.canvas.style.cursor="default"},e.prototype.onMouseMove=function(t){var e,r,i,n;if(this.enabled){i=t.canvasPoint,n=this.handles;for(e in n)if(r=n[e],r.containsCanvasPoint(i)){switch(e){case"tl":this.canvas.style.cursor="nw-resize";break;case"tm":this.canvas.style.cursor="n-resize";break;case"tr":this.canvas.style.cursor="ne-resize";break;case"ml":this.canvas.style.cursor="w-resize";break;case"mr":this.canvas.style.cursor="e-resize";break;case"bl":this.canvas.style.cursor="sw-resize";break;case"bm":this.canvas.style.cursor="s-resize";break;case"br":this.canvas.style.cursor="se-resize"}return}return this.canvas.style.cursor="move"}},e.prototype.constrainPointInParent=function(t){return{x:Math.min(Math.max(t.x,0),this.parent.frame().w),y:Math.min(Math.max(t.y,0),this.parent.frame().h)}},e.prototype.onMouseUp=function(){return this.dragging=this.mouseDown=null},e.prototype.onDragStart=function(t){var e,r,i,n,s;n=t.canvasPoint,s=this.handles;for(e in s)if(r=s[e],r.containsCanvasPoint(n))return i=r.convertFromCanvas(n),void(this.dragging={resizeDirection:e,object:r,offsetX:i.x,offsetY:i.y});return i=this.convertFromCanvas(n),this.dragging={object:this,offsetX:i.x,offsetY:i.y}},e.prototype.onDragMove=function(t){var e,r,i,n,s;if(i=t.canvasPoint,(null!=(n=this.dragging)?n.object:void 0)===this)return e=this.convertFromCanvas(i),this.moveTo({x:e.x-this.dragging.offsetX,y:e.y-this.dragging.offsetY}),this.updateCropFrameFromFrame(),this.markDirty();if(null!=(s=this.dragging)?s.resizeDirection:void 0){switch(r=this.parent.convertFromCanvas(i),this.dragging.resizeDirection){case"tl":i=this.constrainPointInParent(r),this.w=this.w+(this.x-i.x),this.h=this.h+(this.y-i.y),this.x=i.x,this.y=i.y;break;case"tm":i=this.constrainPointInParent(r),this.w=this.w,this.h=this.h+(this.y-i.y),this.x=this.x,this.y=i.y;break;case"tr":i=this.constrainPointInParent(r),this.w=i.x-this.x,this.h=this.h+(this.y-i.y),this.x=this.x,this.y=i.y;break;case"ml":i=this.constrainPointInParent(r),this.w=this.w+(this.x-i.x),this.h=this.h,this.x=i.x,this.y=this.y;break;case"mr":i=this.constrainPointInParent(r),this.w=i.x-this.x,this.h=this.h,this.x=this.x,this.y=this.y;break;case"bl":i=this.constrainPointInParent(r),this.w=this.w+(this.x-i.x),this.h=i.y-this.y,this.x=i.x,this.y=this.y;break;case"bm":i=this.constrainPointInParent(r),this.w=this.w,this.h=i.y-this.y,this.x=this.x,this.y=this.y;break;case"br":i=this.constrainPointInParent(r),this.w=i.x-this.x,this.h=i.y-this.y,this.x=this.x,this.y=this.y}return this.updateCropFrameFromFrame(),this.markDirty()}},e.prototype.onDragEnd=function(t){var e,r;return r=t.canvasPoint,e=this.frame(),this.x=e.x,this.y=e.y,this.w=e.w,this.h=e.h,this.trigger("change",this.cropFrame())},e.prototype.onClick=function(){},e.prototype.moveTo=function(t){var e,r,i;return e=this.convertToParent(t),r=Math.max(0,e.x),i=Math.max(0,e.y),r=Math.min(this.parent.bounds().w-this.w,r),i=Math.min(this.parent.bounds().h-this.h,i),this.x=r,this.y=i},e.prototype.setLooseTheAnts=function(){var t;return t=function(e){return function(){return e.marchingAnts&&(e.dashOffset+=.15,e.markDirty()),window.requestAnimationFrame(t)}}(this),window.requestAnimationFrame(t)},e.prototype.drawScreen=function(t){var e;return e=this.frame(),e.x=Math.round(e.x),e.y=Math.round(e.y),e.w=Math.round(e.w),e.h=Math.round(e.h),this.topScreen.set({parent:this.parent,x:0,y:0,w:this.parent.w,h:e.y}),this.bottomScreen.set({parent:this.parent,x:0,y:e.y+e.h,w:this.parent.w,h:this.parent.h-(e.y+e.h)}),this.leftScreen.set({parent:this.parent,x:0,y:e.y,w:e.x,h:e.h}),this.rightScreen.set({parent:this.parent,x:e.x+e.w,y:e.y,w:this.parent.w-(e.x+e.w),h:e.h}),this.topScreen.render(t),this.leftScreen.render(t),this.rightScreen.render(t),this.bottomScreen.render(t)},e.prototype.drawHandles=function(t){var e,r,i,n,o,a;r=this.frame(),r.x=Math.round(r.x),r.y=Math.round(r.y),r.w=Math.round(r.w),r.h=Math.round(r.h),n=function(t){return function(e,r){return new s.Rectangle({parent:t,x:e-t.handleSize/2-.5,y:r-t.handleSize/2-.5,w:t.handleSize,h:t.handleSize,lineWidth:1,strokeStyle:"rgba(192, 192, 192, 1)",fillStyle:"rgba(64, 64, 64, 1)"})}}(this),this.handles.tl=n(0,0),this.handles.tm=n(r.w/2,0),this.handles.tr=n(r.w,0),this.handles.ml=n(0,r.h/2),this.handles.mr=n(r.w,r.h/2),this.handles.bl=n(0,r.h),this.handles.bm=n(r.w/2,r.h),this.handles.br=n(r.w,r.h),o=this.handles,a=[];for(e in o)i=o[e],a.push(i.render(t));return a},e.prototype.drawCropLines=function(t){var e,r,i;return e=this.frame(),e.x=Math.round(e.x),e.y=Math.round(e.y),e.w=Math.round(e.w),e.h=Math.round(e.h),i="0.5",r=4,this.positionContext(t,function(t){return function(n){var s,o,a,h,u,c,p,d,l;for(n.lineDashOffset=t.dashOffset,n.beginPath(),n.strokeStyle="rgba(255,255,255,1)",n.rect(.5,.5,e.w,e.h),n.closePath(),n.stroke(),n.beginPath(),n.strokeStyle="rgba(0,0,0,1)",n.setLineDash([r]),n.rect(.5,.5,e.w,e.h),n.closePath(),n.stroke(),n.lineDashOffset=0,p=[e.w/3+.5,e.w/3*2+.5],a=0,u=p.length;u>a;a++)s=p[a],n.beginPath(),n.moveTo(s,0),n.strokeStyle="rgba(255,255,255,"+i+")",n.setLineDash([]),n.lineTo(s,e.h),n.stroke(),n.beginPath(),n.moveTo(s,0),n.strokeStyle="rgba(0,0,0,"+i+")",n.setLineDash([r]),n.lineTo(s,e.h),n.stroke();for(d=[e.h/3+.5,e.h/3*2+.5],l=[],h=0,c=d.length;c>h;h++)o=d[h],n.beginPath(),n.moveTo(0,o),n.strokeStyle="rgba(255,255,255,"+i+")",n.setLineDash([]),n.lineTo(e.w,o),n.stroke(),n.beginPath(),n.moveTo(0,o),n.strokeStyle="rgba(0,0,0,"+i+")",n.setLineDash([r]),n.lineTo(e.w,o),l.push(n.stroke());return l}}(this))},e.prototype.draw=function(t){return this.drawScreen(t),this.drawCropLines(t),this.drawHandles(t)},e}(s.Drawable),r["default"]=i}),define("rodeo-crop",["funderscore","drawing","events","canvas-image","crop-box","stage","exports"],function(t,e,r,i,n,s,o){"use strict";var a,h,u=t["default"],c=e["default"],p=r["default"],d=i["default"],l=n["default"],g=s["default"],f={}.hasOwnProperty,y=function(t,e){function r(){this.constructor=t}for(var i in e)f.call(e,i)&&(t[i]=e[i]);return r.prototype=e.prototype,t.prototype=new r,t.__super__=e.prototype,t};h={},a=function(t){function e(t,e){this.el=u.isString(t)?document.querySelector(t):t,this.options=u.extend({cropEnabled:!0,cropX:null,cropY:null,cropWidth:null,cropHeight:null,marchingAnts:!0,handleSize:10,width:100,height:100,imageSource:null},e),this.ctx=null,this.stage=null,this.imageSource=this.options.imageSource,this.initializeCanvas(),this.createStage(),this.createImage(),this.createCropBox(),this.runLoop()}return y(e,t),e.prototype.initializeCanvas=function(){return this.canvas=document.createElement("canvas"),this.canvas.width=this.options.width,this.canvas.height=this.options.height,this.canvas.style.display="block",this.el.appendChild(this.canvas),this.ctx=this.canvas.getContext("2d")},e.prototype.createStage=function(){return this.stage=new g({canvas:this.canvas})},e.prototype.createImage=function(){return this.paddedContainer=new c.PaddedContainer({padding:this.options.handleSize/2+1}),this.image=new d({canvas:this.canvas,source:this.imageSource}),this.image.on("load",function(t){return function(){return t.image.resizeToParent(),t.image.centerOnParent()}}(this)),this.stage.on("resize",function(t){return function(){return t.image.resizeToParent(),t.image.centerOnParent()}}(this)),this.paddedContainer.addChild(this.image),this.stage.addChild(this.paddedContainer)},e.prototype.createCropBox=function(){return this.cropBox=new l({enabled:this.options.cropEnabled,canvas:this.canvas,image:this.image,cropX:this.options.cropX,cropY:this.options.cropY,cropWidth:this.options.cropWidth,cropHeight:this.options.cropHeight,handleSize:this.options.handleSize,marchingAnts:this.options.marchingAnts}),this.cropBox.on("disabled",function(t){return function(e){return t.trigger("disabled",e)}}(this)),this.cropBox.on("enabled",function(t){return function(e){return t.trigger("enabled",e)}}(this)),this.cropBox.on("change",function(t){return function(e){return t.trigger("change",e)}}(this)),this.image.on("resize",function(t){return function(){return t.cropBox.updateFrameFromCropFrame()}}(this)),this.image.on("adjustBrightness",function(t){return function(e,r,i){return t.trigger("adjustBrightness",r,i)}}(this)),this.image.on("adjustContrast",function(t){return function(e,r,i){return t.trigger("adjustContrast",r,i)}}(this)),this.image.addChild(this.cropBox)},e.prototype.isCropped=function(){return this.image.cropped},e.prototype.isChanged=function(){return this.image.isChanged()},e.prototype.getImageSource=function(){return this.image.getSource()},e.prototype.setImageSource=function(t){return this.image.setSource(t)},e.prototype.setCropFrame=function(t){return this.cropBox.setCropFrameAndUpdateFrame(t),this.cropBox.cropFrame()},e.prototype.enableCrop=function(t){return this.cropBox.enable(t)},e.prototype.revertImage=function(){return this.image.revertImage()},e.prototype.undo=function(){return this.image.undo()},e.prototype.cropImage=function(){return this.cropBox.enabled?this.image.crop(this.cropBox.cropFrame()):void 0},e.prototype.adjustBrightness=function(t){return this.image.adjustBrightness(t)},e.prototype.adjustContrast=function(t){return this.image.adjustContrast(t)},e.prototype.commitChanges=function(){return this.image.commitChanges()},e.prototype.toDataURL=function(t){return null==t&&(t="image/png"),this.image.toDataURL(t)},e.prototype.updateCanvasSize=function(){var t,e;return e=window.getComputedStyle(this.canvas.parentNode).getPropertyValue("width"),t=window.getComputedStyle(this.canvas.parentNode).getPropertyValue("height"),e=parseInt(e,10),t=parseInt(t,10),this.canvas.width!==e||this.canvas.height!==t?(this.canvas.width=e,this.canvas.height=t,!0):!1},e.prototype.runLoop=function(){var t;return t=this.updateCanvasSize(),(t||this.stage.dirty)&&(this.stage.clear(this.ctx),t&&this.stage.trigger("resize"),this.stage.render(this.ctx)),window.requestAnimationFrame(function(t){return function(){return t.runLoop()}}(this))},e}(p),h.Cropper=a,h._=u,o["default"]=h}),define("stage",["funderscore","drawing","events","exports"],function(t,e,r,i){"use strict";var n,s=(t["default"],e["default"]),o=r.Event,a={}.hasOwnProperty,h=function(t,e){function r(){this.constructor=t}for(var i in e)a.call(e,i)&&(t[i]=e[i]);return r.prototype=e.prototype,t.prototype=new r,t.__super__=e.prototype,t};n=function(t){function e(t){e.__super__.constructor.call(this,t),this.canvas=t.canvas,this.lastMouseDownTarget=null,this.lastMouseMoveTarget=null,this.dragTarget=null,this.clickTarget=null,this.attachListeners()}return h(e,t),e.prototype.bubbleMouseEvent=function(t,e,r,i){var n;return n=new o({target:t,originalEvent:r,canvasPoint:i}),t.bubble(e,n)},e.prototype.attachListeners=function(){return this.canvas.addEventListener("mouseup",function(t){return function(e){var r,i;if(1===e.which)return r=t.windowToCanvas(e),i=t.findChildAtPoint(r)||t,t.bubbleMouseEvent(i,"mouseup",e,r),t.clickTarget===i&&t.bubbleMouseEvent(t.clickTarget,"click",e,r),t.lastMouseDownTarget=null,t.lastMouseMoveTarget=null,t.clickTarget=null}}(this)),this.canvas.addEventListener("mousedown",function(t){return function(e){var r,i,n,s;if(1===e.which)return n=t.windowToCanvas(e),s=t.findChildAtPoint(n)||t,t.bubbleMouseEvent(s,"mousedown",e,n),t.lastMouseDownTarget=s,t.clickTarget=s,t.movedSinceMouseDown=!1,r=function(e){return e.preventDefault(),n=t.windowToCanvas(e),t.lastMouseDownTarget?(t.dragTarget||(t.bubbleMouseEvent(t.lastMouseDownTarget,"dragstart",e,n),t.dragTarget=t.lastMouseDownTarget),t.bubbleMouseEvent(t.dragTarget,"dragmove",e,n)):void 0},i=function(e){return e.preventDefault(),t.dragTarget&&(n=t.windowToCanvas(e),t.bubbleMouseEvent(t.dragTarget,"dragend",e,n)),t.lastMouseDownTarget=null,t.lastMouseMoveTarget=null,t.dragTarget=null,t.canvasContainsWindowPoint(e)||(t.clickTarget=null),window.removeEventListener("mousemove",r),window.removeEventListener("mouseup",i)},window.addEventListener("mousemove",r),window.addEventListener("mouseup",i)}}(this)),this.canvas.addEventListener("mouseout",function(t){return function(e){var r;return r=t.windowToCanvas(e),t.lastMouseMoveTarget?t.bubbleMouseEvent(t.lastMouseMoveTarget,"mouseout",e,r):void 0}}(this)),this.canvas.addEventListener("mousemove",function(t){return function(e){var r,i;return r=t.windowToCanvas(e),i=t.findChildAtPoint(r)||t,t.bubbleMouseEvent(i,"mousemove",e,r),i!==t.lastMouseMoveTarget&&(t.lastMouseMoveTarget&&t.bubbleMouseEvent(t.lastMouseMoveTarget,"mouseout",e,r),t.bubbleMouseEvent(i,"mouseover",e,r)),t.lastMouseMoveTarget=i}}(this))},e.prototype.canvasContainsWindowPoint=function(t){var e;return e=this.canvas.getBoundingClientRect(),t.clientX>=e.left&&t.clientX<=e.right&&t.clientY>=e.top&&t.clientY<=e.bottom},e.prototype.windowToCanvas=function(t){var e,r,i;return e=this.canvas.getBoundingClientRect(),r=t.clientX-e.left-parseInt(window.getComputedStyle(this.canvas).getPropertyValue("padding-left"),0),i=t.clientY-e.top-parseInt(window.getComputedStyle(this.canvas).getPropertyValue("padding-top"),0),{x:r,y:i}},e.prototype.frame=function(){return{x:0,y:0,w:this.canvas.width,h:this.canvas.height}},e.prototype.bounds=function(){return this.frame()},e}(s.Drawable),i["default"]=n}),define("vendor/loader",[],function(){"use strict";var t,e,r,i;!function(){var n={},s={};t=function(t,e,r){n[t]={deps:e,callback:r}},i=r=e=function(t){function r(e){if("."!==e.charAt(0))return e;for(var r=e.split("/"),i=t.split("/").slice(0,-1),n=0,s=r.length;s>n;n++){var o=r[n];if(".."===o)i.pop();else{if("."===o)continue;i.push(o)}}return i.join("/")}if(i._eak_seen=n,s.hasOwnProperty(t))return s[t];if(s[t]={},!n[t])throw new Error("Could not find module "+t);for(var o,a=n[t],h=a.deps,u=a.callback,c=[],p=0,d=h.length;d>p;p++)c.push("exports"===h[p]?o={}:e(r(h[p])));var l=u.apply(this,c);return s[t]=o||l}}()}),window.RodeoDraw||(window.RodeoDraw={}),window.RodeoDraw.CanvasImage=require("canvas-image").default,window.RodeoDraw.Drawing=require("drawing").default,window.RodeoDraw.Events=require("events").default,window.RodeoDraw.Stage=require("stage").default,window.RodeoCrop=require("rodeo-crop").default;