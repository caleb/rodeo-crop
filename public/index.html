<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <script src="javascripts/rodeo-crop.js"></script>

  <style>
    body, html { height: 100%; margin: 0; padding: 0; }
    #container {
      background-color: black;
      height: 100%;
      width: 100%;
    }
  </style>
</head>
<body>

  <form action="#">
    <input type="text" name="x">, <input type="text" name="y"> â€” <input type="text" name="w">&times;<input type="text" name="h">
    <button id="update-crop">update!</button>

    <button id="change-image">change image</button>
  </form>

  <div id="container">
    <!-- <img src="http://placekitten.com/980/768"> -->
  </div>

  <script>
    var images = [
      '/Costa%20Rican%20Frog.jpg',
      'MondoCabin.jpg'
    ]
    var index = 0
    var crops = []

    var container = document.getElementById("container");
    var w = window.getComputedStyle(container).getPropertyValue("width")
    var h = window.getComputedStyle(container).getPropertyValue("height")

    var xbox = document.querySelector('[name=x]');
    var ybox = document.querySelector('[name=y]');
    var wbox = document.querySelector('[name=w]');
    var hbox = document.querySelector('[name=h]');

    cropper = new RodeoCrop.Cropper("#container", {
      width: parseInt(w, 10),
      height: parseInt(h, 10),
      imageSource: images[index]
    });

    cropper.on('change', function(frame) {
      xbox.value = frame.x;
      ybox.value = frame.y;
      wbox.value = frame.width;
      hbox.value = frame.height;

      if (! crops[index]) {
        crops[index] = {};
      }
      crops[index] = frame;
    });

    var cropFrame = cropper.setCropFrame({
      x: 222,
      y: 222,
      width: 321,
      height: 923
    });

    xbox.value = cropFrame.x;
    ybox.value = cropFrame.y;
    wbox.value = cropFrame.width;
    hbox.value = cropFrame.height;

    button = document.querySelector('#change-image')
    button.addEventListener('click', function(e) {
      e.preventDefault();

      index++;

      if (index >= images.length) {
        index = 0;
      }

      cropper.setImageSource(images[index]);
      var cropFrame = cropper.setCropFrame(crops[index])

      xbox.value = cropFrame.x;
      ybox.value = cropFrame.y;
      wbox.value = cropFrame.width;
      hbox.value = cropFrame.height;
    })

    button = document.querySelector('#update-crop')
    button.addEventListener('click', function(e) {
      e.preventDefault();

      var cropFrame = cropper.setCropFrame({
        x: parseFloat(xbox.value, 10),
        y: parseFloat(ybox.value, 10),
        width: parseFloat(wbox.value, 10),
        height: parseFloat(hbox.value, 10)
      });

      xbox.value = cropFrame.x;
      ybox.value = cropFrame.y;
      wbox.value = cropFrame.width;
      hbox.value = cropFrame.height;
    });
  </script>
</body>
</html>
